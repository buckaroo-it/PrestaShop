{"ast":null,"code":"import { ref, inject, computed } from 'vue';\nimport { useApi } from \"../lib/api.ts\";\nimport { useToastr } from \"../lib/toastr.ts\";\nimport CustomScriptsInput from '../components/CustomScriptsInput.vue';\nimport ToggleField from '../components/fields/ToggleField.vue';\nexport default {\n  name: \"Settings\",\n  components: {\n    CustomScriptsInput,\n    ToggleField\n  },\n  watch: {\n    credentialsAreValid(value) {\n      if (value) {\n        setTimeout(() => {\n          this.credentialsAreValid = null;\n        }, 3000);\n      }\n    }\n  },\n  setup() {\n    const showWebsiteKey = ref(false);\n    const showSecretKey = ref(false);\n    const settings = ref(null);\n    const showAdvanceSettings = ref(false);\n    const app = inject('app');\n    const {\n      get,\n      post,\n      data,\n      loading\n    } = useApi('/index.php?fc=module&module=buckaroo&controller=api&action=settings');\n    const testCredentialsApi = useApi(`/test-credentials`);\n    const {\n      toastr\n    } = useToastr();\n    const credentialsAreValid = ref(null);\n    const getSettings = () => {\n      get().then(() => {\n        console.log(data);\n        if (data.value.status) {\n          settings.value = data.value.settings;\n        }\n      });\n    };\n    const updateSettings = () => {\n      post(settings.value).then(() => {\n        if (data.value.status) {\n          settings.value = data.value.app;\n          toastr.success(this.$t('dashboard.pages.settings.settings_successfully_updated'));\n        }\n      });\n    };\n    const testCredentials = () => {\n      credentialsAreValid.value = null;\n      if (settings.value.website_key && settings.value.secret_key) {\n        testCredentialsApi.post({\n          website_key: settings.value.website_key,\n          secret_key: settings.value.secret_key\n        }).then(() => {\n          credentialsAreValid.value = testCredentialsApi.data.value.status;\n        });\n      }\n    };\n    const displayExampleTransactionDescription = computed(() => {\n      if (settings.value.transaction_description) {\n        return settings.value.transaction_description.replaceAll('{shop_name}', 'Your Shop Name').replaceAll('{order_number}', '123456789');\n      }\n    });\n    getSettings();\n    return {\n      updateSettings,\n      loading,\n      settings,\n      testCredentials,\n      credentialsAreValid,\n      testCredentialsApi,\n      showWebsiteKey,\n      showSecretKey,\n      getSettings,\n      displayExampleTransactionDescription,\n      showAdvanceSettings\n    };\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}