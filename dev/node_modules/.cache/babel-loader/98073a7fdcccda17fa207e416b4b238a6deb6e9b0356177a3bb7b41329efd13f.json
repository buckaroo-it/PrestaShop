{"ast":null,"code":"import { computed, ref, watch } from 'vue';\nimport { useApi } from '../../lib/api';\nimport GiftcardModal from './GiftcardModal.vue';\nexport default {\n  name: \"ActiveGiftcards.vue\",\n  props: [\"modelValue\"],\n  components: {\n    GiftcardModal\n  },\n  watch: {\n    modelValue(value) {\n      this.activatedGiftcards = value;\n    },\n    activatedGiftcards: {\n      handler(value, oldValue) {\n        this.$emit('update:modelValue', value);\n      },\n      deep: true\n    }\n  },\n  setup(props, {\n    emit\n  }) {\n    const query = ref('');\n    const giftcards = ref([]);\n    const customGiftcards = ref([]);\n    const activatedGiftcards = ref(props.modelValue ?? []);\n    const bigcommerceAppUrl = import.meta.env.VITE_BUCKAROO_BIGCOMMERCE_APP_URL;\n    const {\n      get,\n      data\n    } = useApi('giftcards');\n    get().then(() => {\n      if (data.value.status) {\n        giftcards.value = data.value.giftcards.map(giftcard => {\n          giftcard.logo_url = `${bigcommerceAppUrl}/modules/buckaroo/views/img/giftcards/${giftcard.logo}`;\n          giftcard.giftcard = false;\n          return giftcard;\n        });\n        customGiftcards.value = data.value.custom_giftcards.map(giftcard => {\n          giftcard.isCustom = true;\n          return giftcard;\n        });\n      }\n    });\n    const filteredGiftcards = computed(() => {\n      if (query.value.trim().length === 0) {\n        return giftcards.value.concat(customGiftcards.value);\n      }\n      return giftcards.value.filter(giftcardHasName(query.value)).concat(customGiftcards.value.filter(giftcardHasName(query.value)));\n    });\n    const giftcardHasName = partialName => {\n      return giftcard => giftcard.name.toLowerCase().includes(partialName.toLowerCase());\n    };\n    const appendCustomGiftcard = customGiftcard => {\n      customGiftcards.value.push(customGiftcard);\n    };\n    const removeCustomGiftcard = customGiftcard => {\n      customGiftcards.value = customGiftcards.value.filter(giftcard => customGiftcard.id !== giftcard.id);\n    };\n    const toggleGiftcard = giftcard => {\n      const customGiftcards = activatedGiftcards.value.customGiftcards ?? [];\n      const giftcards = activatedGiftcards.value.giftcards ?? [];\n      if (giftcard.isCustom) {\n        if (customGiftcards.find(cg => cg.id === giftcard.id)) {\n          activatedGiftcards.value.customGiftcards = customGiftcards.filter(cg => cg.id !== giftcard.id);\n          return;\n        }\n        customGiftcards.push(giftcard);\n      }\n      if (!giftcard.isCustom) {\n        if (giftcards.find(g => g.id === giftcard.id)) {\n          activatedGiftcards.value.giftcards = giftcards.filter(g => g.id !== giftcard.id);\n          return;\n        }\n        giftcards.push(giftcard);\n      }\n      activatedGiftcards.value = {\n        customGiftcards: customGiftcards,\n        giftcards: giftcards\n      };\n    };\n    return {\n      query,\n      customGiftcards,\n      filteredGiftcards,\n      toggleGiftcard,\n      activatedGiftcards,\n      bigcommerceAppUrl,\n      appendCustomGiftcard,\n      removeCustomGiftcard\n    };\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}